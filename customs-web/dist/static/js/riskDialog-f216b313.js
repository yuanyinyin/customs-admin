import{d as e,p as a,r as l,a as o,g as t,f as d,w as u,j as i,b as r,y as s,X as p,F as m,h as n,i as f,ag as v,K as D,Y as b}from"./vendor-78a6dd30.js";import{g,j as h,q as c}from"./index-30d780dc.js";const y={class:"dialog-footer"},V=D("取 消"),w=D("确 定"),I=D("确 定"),_=e({props:{userDialog:{require:!0,default:null,type:Object},formData:{require:!0,default:null,type:Object}},emits:["userHandleSubmitAdd","userHandleSubmitEdit"],setup(e,{emit:D}){const _=e,k=a(!1),j=a([]),U=[{value:"0",label:"一般"},{value:"1",label:"较大风险"}],x=a("https://www.nteport.com/ycjAdmin"),q=a({authToken:g()}),P=a([]),C=a(""),H=a(!1),S=a(null),T=a({pointId:[{required:!0,message:"请选择地点",trigger:"blur"}],type:[{required:!0,message:"请选风险类别",trigger:"blur"}]}),A=e=>{e?(k.value=!0,h({pointName:e}).then((e=>{k.value=!1,j.value=e.data}))):j.value=[]},E=(e,a,l)=>{_.formData.photoId?_.formData.photoId+=e.data+",":_.formData.photoId=e.data+","},F=e=>{C.value=e.url,H.value=!0},G=(e,a)=>{void 0===e.response?_.formData.photoId=_.formData.photoId.replace(e.name+",",""):_.formData.photoId=_.formData.photoId.replace(e.response.data+",","")},O=()=>{_.userDialog.show=!1,S.value.resetFields(),P.value=[],j.value=[]},B=()=>{if(_.formData.id&&(_.formData.pointId?c({Id:_.formData.pointId}).then((e=>{j.value.push({name:e.data.name,id:e.data.id})})):j.value=[],_.formData.photoId)){let a=_.formData.photoId.split(",");for(var e=0;e<a.length;e++)""!=a[e]&&P.value.push({name:a[e],url:x.value+"/file/downLoad/"+a[e]})}};return(a,g)=>{const h=l("el-form-item"),c=l("el-input"),J=l("el-option"),K=l("el-select"),L=l("el-icon"),M=l("el-upload"),N=l("el-image"),X=l("el-dialog"),Y=l("el-form"),z=l("el-button");return o(),t("div",null,[d(X,{modelValue:e.userDialog.show,"onUpdate:modelValue":g[9]||(g[9]=a=>e.userDialog.show=a),title:e.userDialog.title,width:"60%",center:"",onOpen:B,onClose:O},{footer:u((()=>[i("span",y,[d(z,{onClick:O},{default:u((()=>[V])),_:1}),"add"===e.userDialog.option?(o(),r(z,{key:0,type:"primary",onClick:g[7]||(g[7]=e=>{S.value.validate((e=>{if(!e)return!1;"add"===_.userDialog.option&&D("userHandleSubmitAdd")}))})},{default:u((()=>[w])),_:1})):s("v-if",!0),"edit"===e.userDialog.option?(o(),r(z,{key:1,type:"primary",onClick:g[8]||(g[8]=e=>{S.value.validate((e=>{if(!e)return!1;"edit"===_.userDialog.option&&D("userHandleSubmitEdit")}))})},{default:u((()=>[I])),_:1})):s("v-if",!0)])])),default:u((()=>[d(Y,{ref_key:"refUserForm",ref:S,model:e.formData,rules:T.value,"label-width":"80px"},{default:u((()=>["edit"===e.userDialog.option?p((o(),r(h,{key:0,label:"id",prop:"id"},null,512)),[[b,!1]]):s("v-if",!0),"detail"===e.userDialog.option?(o(),r(h,{key:1,label:"上报日期",prop:"reportTime"},{default:u((()=>[d(c,{modelValue:e.formData.reportTime,"onUpdate:modelValue":g[0]||(g[0]=a=>e.formData.reportTime=a),placeholder:"上报日期",disabled:"detail"==e.userDialog.option,style:{width:"300px"}},null,8,["modelValue","disabled"])])),_:1})):s("v-if",!0),d(h,{label:"隐患地点",prop:"pointId"},{default:u((()=>[d(K,{disabled:"detail"==e.userDialog.option,style:{width:"300px"},modelValue:e.formData.pointId,"onUpdate:modelValue":g[1]||(g[1]=a=>e.formData.pointId=a),filterable:"",remote:"","reserve-keyword":"",clearable:"",placeholder:"请输入点位，搜索后选择","remote-method":A,loading:k.value},{default:u((()=>[(o(!0),t(m,null,n(j.value,(e=>(o(),r(J,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue","loading"])])),_:1}),d(h,{label:"风险类别",prop:"type"},{default:u((()=>[d(K,{disabled:"detail"==e.userDialog.option,modelValue:e.formData.type,"onUpdate:modelValue":g[2]||(g[2]=a=>e.formData.type=a),placeholder:"请选风险类别",style:{width:"300px"}},{default:u((()=>[(o(),t(m,null,n(U,(e=>d(J,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["disabled","modelValue"])])),_:1}),d(h,{label:"现场图片",prop:"photoId"},{default:u((()=>[d(M,{action:x.value+"/file/upload?type=21","list-type":"picture-card",accept:".jpg,.jpeg,.png,.bmp,.JPG,.JPEG,.PBG,.BMP","on-success":E,"on-preview":F,"on-remove":G,"auto-upload":!0,headers:q.value,disabled:"detail"==e.userDialog.option,"file-list":P.value},{default:u((()=>[d(L,null,{default:u((()=>[d(f(v))])),_:1})])),_:1},8,["action","headers","disabled","file-list"])])),_:1}),d(X,{modelValue:H.value,"onUpdate:modelValue":g[3]||(g[3]=e=>H.value=e)},{default:u((()=>[d(N,{src:C.value,alt:"Preview Image"},null,8,["src"])])),_:1},8,["modelValue"]),d(h,{label:"具体情况",prop:"situation"},{default:u((()=>[d(c,{modelValue:e.formData.situation,"onUpdate:modelValue":g[4]||(g[4]=a=>e.formData.situation=a),placeholder:"详情",rows:10,type:"textarea",disabled:"detail"==e.userDialog.option},null,8,["modelValue","disabled"])])),_:1}),d(h,{label:"备注",prop:"memo"},{default:u((()=>[d(c,{modelValue:e.formData.memo,"onUpdate:modelValue":g[5]||(g[5]=a=>e.formData.memo=a),placeholder:"备注（最多100字）",disabled:"detail"==e.userDialog.option},null,8,["modelValue","disabled"])])),_:1}),d(h,{label:"处置情况",prop:"result"},{default:u((()=>[d(c,{modelValue:e.formData.result,"onUpdate:modelValue":g[6]||(g[6]=a=>e.formData.result=a),placeholder:"处置情况",disabled:"detail"==e.userDialog.option,"v-show":"add"!=e.userDialog.option},null,8,["modelValue","disabled","v-show"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{_ as default};
